#!/bin/bash
set -u
set -e
NAME="debian_sid_post_install"
DESCRIPTION="unstable/sid configuration"
PREFER="/etc/apt/preferences"
LIST="/etc/apt/sources.list"
DEB="http://http.debian.net/debian/" 
TEST="jessie"
GITHUB="https://github.com/vonbrownie"
SOURCE="${GITHUB}/linux-post-install/blob/master/debian_sid_post_install"
# Notes
# * Install Debian Wheezy Screenshot Tour
#   http://www.circuidipity.com/install-debian-wheezy-screenshot-tour.html

# LICENSE
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License (GPLv2) published
# by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
# or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
# for more details.

greeting() {
cat << _EOF_

$NAME - $DESCRIPTION

Howdy! Ideally this script is run following a fresh installation of
Debian GNU/Linux.

See: "Install Debian Wheezy Screenshot Tour"
http://www.circuidipity.com/install-debian-wheezy-screenshot-tour.html

This system will be configured to track Debian's sid/unstable branch
with the option of installing the lightweight Openbox window manager
+ extra apps suitable for a desktop environment.

_EOF_
}

penguinista() {
cat << _EOF_

(O<
(/)_
_EOF_
}

test_root() {
if [[ $UID -ne 0 ]]
then
    printf "\n$( penguinista ) .: $NAME requires ROOT privileges to do its job.\n"
    exit 1
fi
}

interface_found() {
ip link | awk '/mtu/ {gsub(":",""); printf "\t%s", $2} END {printf "\n"}'
}

test_connect() {
if ! $(ip addr show | grep "state UP" &>/dev/null)
then
    printf "\n$( penguinista ) .: $NAME requires an active network interface."
    printf "\nINTERFACES FOUND\n"
    interface_found
    exit 1
fi
}

test_condition() {
test_root
test_connect
}

invalid_reply() {
printf "\n'$REPLY' is invalid input...\n"
}

invalid_reply_yn() {
printf "\n'$REPLY' is invalid input. Please select 'Y(es)' or 'N(o)'...\n"
}

confirm_start() {
while :
do
    read -n 1 -p "Run script now? [yN] > "
    if [[ $REPLY == [yY] ]]
    then
        printf "\nLet's roll then ...\n"
        sleep 2
        break
    elif [[ $REPLY == [nN] || $REPLY == "" ]]
    then
        penguinista
        exit
    else
        invalid_reply_yn
    fi
done
}

config_prefer() {
cat > $PREFER << _EOF_
# Configure default preferences in package installation
# * unlisted repositories are auto-ranked 500
# * installed packages are ranked 100

Package: *
Pin: release a=unstable
Pin-Priority: 900

Package: *
Pin: release a=experimental
Pin-Priority: 1
_EOF_
}

apt_prefer() {
if [[ -e $PREFER ]]
then
    cp $PREFER ${PREFER}.$(date +%Y%m%dT%H%M%S).bak
fi
config_prefer
}

config_source() {
cat > $LIST << _EOF_
### unstable ###
deb $DEB unstable main contrib non-free
deb-src $DEB unstable main contrib non-free

### $TEST ###
deb $DEB $TEST main contrib non-free
#deb-src $DEB $TEST main contrib non-free

### $TEST security ###
deb http://security.debian.org/ $TEST/updates main contrib non-free
#deb-src http://security.debian.org/ $TEST/updates main contrib non-free

### experimental ###
deb $DEB experimental main

### multimedia ###
deb http://www.deb-multimedia.org unstable main non-free
_EOF_
clear
apt-get update
}

apt_source() {
if [[ -e $LIST ]]
then
    mv $LIST ${LIST}.$(date +%Y%m%dT%H%M%S).bak
fi
config_source
}

apt_key() {
    :
}

apt_purge() {
    :
}

pkg_console() {
    :
}

pkg_desktop() {
    :
}

pkg_openbox() {
    :
}

pkg_theme() {
    :
}

pkg_dvd() {
    :
}

pkg_experiment() {
    :
}

pkg_non_deb() {
    :
}

config_desktop() {
    :
}

config_blacklist() {
    :
}

config_alternative() {
    :
}

config_group() {
    :
}

config_timezone() {
    :
}

au_revoir() {
clear
printf "$( penguinista ) .: All done!\n"
}

#: START
test_condition
greeting
confirm_start

#: APT
apt_prefer
apt_source
#apt_key

#: CONFIGURE
#config_desktop
#config_blacklist
#config_alternative
#config_group
#config_timezone

#: FINISH
#apt_purge
#au_revoir
